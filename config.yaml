# Default configuration for scalpel-cli
# NOTE: For production deployments, override settings using environment variables
# (e.g., SCALPEL_DATABASE_URL) or a config.local.yaml file.

logger:
  service_name: "scalpel-cli"
  log_file: "logs/scalpel.log"
  level: "info"
  format: "json"
  add_source: false
  max_size: 10
  max_backups: 3
  max_age: 7
  compress: true
  colors:
    debug: "cyan"
    info: "green"
    warn: "yellow"
    error: "red"
    dpanic: "magenta"
    panic: "magenta"
    fatal: "magenta"

# FIX: Renamed from 'postgres' to 'database' to match the Go struct.
database:
  # This value will be overridden by the SCALPEL_DATABASE_URL environment variable.
  url: ""

engine:
  queue_size: 1000
  worker_concurrency: 8
  default_task_timeout: "15m"

browser:
  headless: true
  ignore_tls_errors: false
  # FIX: Added the missing 'concurrency' field required by the validation logic.
  concurrency: 2
  args:
    - "--no-sandbox"
    - "--disable-setuid-sandbox"
    - "--disable-dev-shm-usage"
    - "--disable-gpu"
    - "--no-first-run"
    - "--no-default-browser-check"
    - "--disable-popup-blocking"
    - "--disable-prompt-on-repost"
    - "--disable-extensions"
    - "--disable-translate"
    - "--disable-sync"
    - "--disable-background-networking"
    - "--disable-component-update"
    - "--metrics-recording-only"
    - "--mute-audio"
    - "--safebrowsing-disable-auto-update"
  viewport:
    width: 1920
    height: 1080

network:
  timeout: "30s"
  post_load_wait: "2s"
  capture_response_bodies: true # Added to ensure HAR files are complete.
  headers:
    User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36 ScalpelV2/1.0"
  proxy:
    enabled: false
    address: "127.0.0.1:8080"
    ca_cert: ""
    ca_key: ""

agent:
  knowledge_graph:
    type: "postgres" # Options: "postgres" or "in-memory"

iast:
  # FIX: Changed keys to snake_case to match the Go struct.
  shim_path: "internal/browser/shim/pinnacle.js"
  config_path: "internal/browser/shim/pinnacle.json"

scanners:
  passive:
    headers:
      enabled: true

  static:
    jwt:
      enabled: true
      known_secrets: []
      brute_force_enabled: true
      dictionary_file: "config/jwt.secrets.list"

  active:
    taint:
      enabled: true
      depth: 3
      concurrency: 2
    protopollution:
      enabled: true
    timeslip:
      enabled: true
      request_count: 25
      max_concurrency: 10
      threshold_ms: 500
    auth:
      ato:
        enabled: true
        credential_file: ""
        concurrency: 4
        min_request_delay_ms: 500
        request_delay_jitter_ms: 500
        success_keywords:
          - "welcome"
          - "redirect"
          - "dashboard"
          - "logout"
          - '"success":true'
        user_failure_keywords:
          - "user not found"
          - "invalid user"
          - "no such account"
          - "user does not exist"
        pass_failure_keywords:
          - "invalid password"
          - "incorrect password"
          - "authentication failed"
        generic_failure_keywords:
          - "login failed"
          - "invalid credentials"
        lockout_keywords:
          - "account locked"
          - "too many attempts"

      idor:
        enabled: true
        ignore_list:
          - "csrf_token"
          - "X-CSRF-Token"
          - "nonce"
          - "viewstate"
        test_strategies:
          NumericID: ["increment", "decrement"]
          UUID: ["horizontal_swap"]
          Base64Encoded: ["bit_flip"]
          ObjectID: ["increment_char"]
